---
source: crates/runtime/tests/integration.rs
description: "Query: SELECT AVG(gas_used) AS avg_gas_used, transaction_count FROM full_blocks WHERE number BETWEEN 100000 AND 200000 GROUP BY transaction_count ORDER BY transaction_count DESC LIMIT 10"
---
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |   Federated                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |  Limit: skip=0, fetch=10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |   Sort: full_blocks.transaction_count DESC NULLS FIRST                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |     Projection: avg(full_blocks.gas_used) AS avg_gas_used, full_blocks.transaction_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |       Aggregate: groupBy=[[full_blocks.transaction_count]], aggr=[[avg(CAST(full_blocks.gas_used AS Float64))]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |         Filter: full_blocks.number BETWEEN Int64(100000) AND Int64(200000)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |           TableScan: full_blocks                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| physical_plan | BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |   CoalescePartitionsExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |     SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |       RepartitionExec: partitioning=RoundRobinBatch(3), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |         VirtualExecutionPlan name=spice.ai compute_context=url=https://flight.spiceai.io,username= sql=SELECT avg(CAST(full_blocks.gas_used AS DOUBLE)) AS avg_gas_used, full_blocks.transaction_count FROM full_blocks WHERE (full_blocks.number BETWEEN 100000 AND 200000) GROUP BY full_blocks.transaction_count ORDER BY full_blocks.transaction_count DESC NULLS FIRST LIMIT 10 rewritten_sql=SELECT avg(CAST(eth.blocks.gas_used AS DOUBLE)) AS avg_gas_used, eth.blocks.transaction_count FROM eth.blocks WHERE (eth.blocks.number BETWEEN 100000 AND 200000) GROUP BY eth.blocks.transaction_count ORDER BY eth.blocks.transaction_count DESC NULLS FIRST LIMIT 10 |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
