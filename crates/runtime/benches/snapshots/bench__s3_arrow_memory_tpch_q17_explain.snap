---
source: crates/runtime/benches/bench.rs
description: "Query: select\n        sum(l_extendedprice) / 7.0 as avg_yearly\nfrom\n    lineitem,\n    part\nwhere\n        p_partkey = l_partkey\n  and p_brand = 'Brand#23'\n  and p_container = 'MED BOX'\n  and l_quantity < (\n    select\n            0.2 * avg(l_quantity)\n    from\n        lineitem\n    where\n            l_partkey = p_partkey\n);"
---
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                    |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Projection: CAST(sum(lineitem.l_extendedprice) AS Float64) / Float64(7) AS avg_yearly                                                                                                                                   |
|               |   Aggregate: groupBy=[[]], aggr=[[sum(lineitem.l_extendedprice)]]                                                                                                                                                       |
|               |     Projection: lineitem.l_extendedprice                                                                                                                                                                                |
|               |       Inner Join: part.p_partkey = __scalar_sq_1.l_partkey Filter: CAST(lineitem.l_quantity AS Decimal128(30, 15)) < __scalar_sq_1.Float64(0.2) * avg(lineitem.l_quantity)                                              |
|               |         Projection: lineitem.l_quantity, lineitem.l_extendedprice, part.p_partkey                                                                                                                                       |
|               |           Inner Join: lineitem.l_partkey = part.p_partkey                                                                                                                                                               |
|               |             BytesProcessedNode                                                                                                                                                                                          |
|               |               TableScan: lineitem projection=[l_partkey, l_quantity, l_extendedprice]                                                                                                                                   |
|               |             Projection: part.p_partkey                                                                                                                                                                                  |
|               |               BytesProcessedNode                                                                                                                                                                                        |
|               |                 Filter: part.p_brand = Utf8("Brand#23") AND part.p_container = Utf8("MED BOX")                                                                                                                          |
|               |                   TableScan: part projection=[p_partkey, p_brand, p_container], partial_filters=[part.p_brand = Utf8("Brand#23"), part.p_container = Utf8("MED BOX")]                                                   |
|               |         SubqueryAlias: __scalar_sq_1                                                                                                                                                                                    |
|               |           Projection: CAST(Float64(0.2) * CAST(avg(lineitem.l_quantity) AS Float64) AS Decimal128(30, 15)), lineitem.l_partkey                                                                                          |
|               |             Aggregate: groupBy=[[lineitem.l_partkey]], aggr=[[avg(lineitem.l_quantity)]]                                                                                                                                |
|               |               TableScan: lineitem projection=[l_partkey, l_quantity]                                                                                                                                                    |
| physical_plan | ProjectionExec: expr=[CAST(sum(lineitem.l_extendedprice)@0 AS Float64) / 7 as avg_yearly]                                                                                                                               |
|               |   AggregateExec: mode=Final, gby=[], aggr=[sum(lineitem.l_extendedprice)]                                                                                                                                               |
|               |     CoalescePartitionsExec                                                                                                                                                                                              |
|               |       AggregateExec: mode=Partial, gby=[], aggr=[sum(lineitem.l_extendedprice)]                                                                                                                                         |
|               |         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                     |
|               |           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(p_partkey@2, l_partkey@1)], filter=CAST(l_quantity@0 AS Decimal128(30, 15)) < Float64(0.2) * avg(lineitem.l_quantity)@1, projection=[l_extendedprice@1] |
|               |             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                 |
|               |               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(l_partkey@0, p_partkey@0)], projection=[l_quantity@1, l_extendedprice@2, p_partkey@3]                                                               |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                             |
|               |                   RepartitionExec: partitioning=Hash([l_partkey@0], 4), input_partitions=4                                                                                                                              |
|               |                     BytesProcessedExec                                                                                                                                                                                  |
|               |                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                              |
|               |                         SchemaCastScanExec                                                                                                                                                                              |
|               |                           MemoryExec: partitions=1, partition_sizes=[0]                                                                                                                                                 |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                             |
|               |                   RepartitionExec: partitioning=Hash([p_partkey@0], 4), input_partitions=4                                                                                                                              |
|               |                     ProjectionExec: expr=[p_partkey@0 as p_partkey]                                                                                                                                                     |
|               |                       BytesProcessedExec                                                                                                                                                                                |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                     |
|               |                           FilterExec: p_brand@1 = Brand#23 AND p_container@2 = MED BOX                                                                                                                                  |
|               |                             SchemaCastScanExec                                                                                                                                                                          |
|               |                               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                      |
|               |                                 MemoryExec: partitions=1, partition_sizes=[25]                                                                                                                                          |
|               |             ProjectionExec: expr=[CAST(0.2 * CAST(avg(lineitem.l_quantity)@1 AS Float64) AS Decimal128(30, 15)) as Float64(0.2) * avg(lineitem.l_quantity), l_partkey@0 as l_partkey]                                   |
|               |               AggregateExec: mode=FinalPartitioned, gby=[l_partkey@0 as l_partkey], aggr=[avg(lineitem.l_quantity)]                                                                                                     |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                             |
|               |                   RepartitionExec: partitioning=Hash([l_partkey@0], 4), input_partitions=4                                                                                                                              |
|               |                     AggregateExec: mode=Partial, gby=[l_partkey@0 as l_partkey], aggr=[avg(lineitem.l_quantity)]                                                                                                        |
|               |                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                              |
|               |                         SchemaCastScanExec                                                                                                                                                                              |
|               |                           MemoryExec: partitions=1, partition_sizes=[0]                                                                                                                                                 |
|               |                                                                                                                                                                                                                         |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
