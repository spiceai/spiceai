---
source: crates/runtime/benches/bench.rs
description: "Query: select\n    c_name,\n    c_custkey,\n    o_orderkey,\n    o_orderdate,\n    o_totalprice,\n    sum(l_quantity)\nfrom\n    customer,\n    orders,\n    lineitem\nwhere\n        o_orderkey in (\n        select\n            l_orderkey\n        from\n            lineitem\n        group by\n            l_orderkey having\n                sum(l_quantity) > 300\n    )\n  and c_custkey = o_custkey\n  and o_orderkey = l_orderkey\ngroup by\n    c_name,\n    c_custkey,\n    o_orderkey,\n    o_orderdate,\n    o_totalprice\norder by\n    o_totalprice desc,\n    o_orderdate;"
---
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: orders.o_totalprice DESC NULLS FIRST, orders.o_orderdate ASC NULLS LAST                                                                                                                                                                                                                                                       |
|               |   Aggregate: groupBy=[[customer.c_name, customer.c_custkey, orders.o_orderkey, orders.o_orderdate, orders.o_totalprice]], aggr=[[sum(lineitem.l_quantity)]]                                                                                                                                                                         |
|               |     LeftSemi Join: orders.o_orderkey = __correlated_sq_1.l_orderkey                                                                                                                                                                                                                                                                 |
|               |       Projection: customer.c_custkey, customer.c_name, orders.o_orderkey, orders.o_totalprice, orders.o_orderdate, lineitem.l_quantity                                                                                                                                                                                              |
|               |         Inner Join: orders.o_orderkey = lineitem.l_orderkey                                                                                                                                                                                                                                                                         |
|               |           Projection: customer.c_custkey, customer.c_name, orders.o_orderkey, orders.o_totalprice, orders.o_orderdate                                                                                                                                                                                                               |
|               |             Inner Join: customer.c_custkey = orders.o_custkey                                                                                                                                                                                                                                                                       |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                                                                    |
|               |                 TableScan: customer projection=[c_custkey, c_name]                                                                                                                                                                                                                                                                  |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                                                                    |
|               |                 TableScan: orders projection=[o_orderkey, o_custkey, o_totalprice, o_orderdate]                                                                                                                                                                                                                                     |
|               |           BytesProcessedNode                                                                                                                                                                                                                                                                                                        |
|               |             TableScan: lineitem projection=[l_orderkey, l_quantity]                                                                                                                                                                                                                                                                 |
|               |       SubqueryAlias: __correlated_sq_1                                                                                                                                                                                                                                                                                              |
|               |         Projection: lineitem.l_orderkey                                                                                                                                                                                                                                                                                             |
|               |           Filter: sum(lineitem.l_quantity) > Decimal128(Some(30000),25,2)                                                                                                                                                                                                                                                           |
|               |             Aggregate: groupBy=[[lineitem.l_orderkey]], aggr=[[sum(lineitem.l_quantity)]]                                                                                                                                                                                                                                           |
|               |               TableScan: lineitem projection=[l_orderkey, l_quantity]                                                                                                                                                                                                                                                               |
| physical_plan | SortPreservingMergeExec: [o_totalprice@4 DESC,o_orderdate@3 ASC NULLS LAST]                                                                                                                                                                                                                                                         |
|               |   SortExec: expr=[o_totalprice@4 DESC,o_orderdate@3 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                   |
|               |     AggregateExec: mode=FinalPartitioned, gby=[c_name@0 as c_name, c_custkey@1 as c_custkey, o_orderkey@2 as o_orderkey, o_orderdate@3 as o_orderdate, o_totalprice@4 as o_totalprice], aggr=[sum(lineitem.l_quantity)]                                                                                                             |
|               |       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                   |
|               |         RepartitionExec: partitioning=Hash([c_name@0, c_custkey@1, o_orderkey@2, o_orderdate@3, o_totalprice@4], 4), input_partitions=4                                                                                                                                                                                             |
|               |           AggregateExec: mode=Partial, gby=[c_name@1 as c_name, c_custkey@0 as c_custkey, o_orderkey@2 as o_orderkey, o_orderdate@4 as o_orderdate, o_totalprice@3 as o_totalprice], aggr=[sum(lineitem.l_quantity)]                                                                                                                |
|               |             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                             |
|               |               HashJoinExec: mode=Partitioned, join_type=LeftSemi, on=[(o_orderkey@2, l_orderkey@0)]                                                                                                                                                                                                                                 |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                         |
|               |                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(o_orderkey@2, l_orderkey@0)], projection=[c_custkey@0, c_name@1, o_orderkey@2, o_totalprice@3, o_orderdate@4, l_quantity@6]                                                                                                                                 |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                     |
|               |                       RepartitionExec: partitioning=Hash([o_orderkey@2], 4), input_partitions=4                                                                                                                                                                                                                                     |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                 |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(c_custkey@0, o_custkey@1)], projection=[c_custkey@0, c_name@1, o_orderkey@2, o_totalprice@4, o_orderdate@5]                                                                                                                                         |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                             |
|               |                               RepartitionExec: partitioning=Hash([c_custkey@0], 4), input_partitions=4                                                                                                                                                                                                                              |
|               |                                 BytesProcessedExec                                                                                                                                                                                                                                                                                  |
|               |                                   ParquetExec: file_groups={4 groups: [[tpch/customer/customer.parquet:0..3344327], [tpch/customer/customer.parquet:3344327..6688654], [tpch/customer/customer.parquet:6688654..10032981], [tpch/customer/customer.parquet:10032981..13377306]]}, projection=[c_custkey, c_name]                    |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                             |
|               |                               RepartitionExec: partitioning=Hash([o_custkey@1], 4), input_partitions=4                                                                                                                                                                                                                              |
|               |                                 BytesProcessedExec                                                                                                                                                                                                                                                                                  |
|               |                                   ParquetExec: file_groups={4 groups: [[tpch/orders/orders.parquet:0..13868792], [tpch/orders/orders.parquet:13868792..27737584], [tpch/orders/orders.parquet:27737584..41606376], [tpch/orders/orders.parquet:41606376..55475165]]}, projection=[o_orderkey, o_custkey, o_totalprice, o_orderdate] |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                     |
|               |                       RepartitionExec: partitioning=Hash([l_orderkey@0], 4), input_partitions=4                                                                                                                                                                                                                                     |
|               |                         BytesProcessedExec                                                                                                                                                                                                                                                                                          |
|               |                           ParquetExec: file_groups={4 groups: [[tpch/lineitem/lineitem.parquet:0..51066574], [tpch/lineitem/lineitem.parquet:51066574..102133148], [tpch/lineitem/lineitem.parquet:102133148..153199722], [tpch/lineitem/lineitem.parquet:153199722..204266296]]}, projection=[l_orderkey, l_quantity]              |
|               |                 ProjectionExec: expr=[l_orderkey@0 as l_orderkey]                                                                                                                                                                                                                                                                   |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                       |
|               |                     FilterExec: sum(lineitem.l_quantity)@1 > Some(30000),25,2                                                                                                                                                                                                                                                       |
|               |                       AggregateExec: mode=FinalPartitioned, gby=[l_orderkey@0 as l_orderkey], aggr=[sum(lineitem.l_quantity)]                                                                                                                                                                                                       |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                 |
|               |                           RepartitionExec: partitioning=Hash([l_orderkey@0], 4), input_partitions=4                                                                                                                                                                                                                                 |
|               |                             AggregateExec: mode=Partial, gby=[l_orderkey@0 as l_orderkey], aggr=[sum(lineitem.l_quantity)]                                                                                                                                                                                                          |
|               |                               ParquetExec: file_groups={4 groups: [[tpch/lineitem/lineitem.parquet:0..51066574], [tpch/lineitem/lineitem.parquet:51066574..102133148], [tpch/lineitem/lineitem.parquet:102133148..153199722], [tpch/lineitem/lineitem.parquet:153199722..204266296]]}, projection=[l_orderkey, l_quantity]          |
|               |                                                                                                                                                                                                                                                                                                                                     |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
