---
source: crates/runtime/benches/bench.rs
description: "Query: select\n    cntrycode,\n    count(*) as numcust,\n    sum(c_acctbal) as totacctbal\nfrom\n    (\n        select\n            substring(c_phone from 1 for 2) as cntrycode,\n            c_acctbal\n        from\n            customer\n        where\n                substring(c_phone from 1 for 2) in\n                ('13', '31', '23', '29', '30', '18', '17')\n          and c_acctbal > (\n            select\n                avg(c_acctbal)\n            from\n                customer\n            where\n                    c_acctbal > 0.00\n              and substring(c_phone from 1 for 2) in\n                  ('13', '31', '23', '29', '30', '18', '17')\n        )\n          and not exists (\n                select\n                    *\n                from\n                    orders\n                where\n                        o_custkey = c_custkey\n            )\n    ) as custsale\ngroup by\n    cntrycode\norder by\n    cntrycode;"
---
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                              |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: custsale.cntrycode ASC NULLS LAST                                                                                                                                                                                                                                                                                                                                           |
|               |   Projection: custsale.cntrycode, count(*) AS numcust, sum(custsale.c_acctbal) AS totacctbal                                                                                                                                                                                                                                                                                      |
|               |     Aggregate: groupBy=[[custsale.cntrycode]], aggr=[[count(Int64(1)) AS count(*), sum(custsale.c_acctbal)]]                                                                                                                                                                                                                                                                      |
|               |       SubqueryAlias: custsale                                                                                                                                                                                                                                                                                                                                                     |
|               |         Projection: substr(customer.c_phone, Int64(1), Int64(2)) AS cntrycode, customer.c_acctbal                                                                                                                                                                                                                                                                                 |
|               |           Inner Join:  Filter: CAST(customer.c_acctbal AS Decimal128(19, 6)) > __scalar_sq_2.avg(customer.c_acctbal)                                                                                                                                                                                                                                                              |
|               |             Projection: customer.c_phone, customer.c_acctbal                                                                                                                                                                                                                                                                                                                      |
|               |               LeftAnti Join: customer.c_custkey = __correlated_sq_1.o_custkey                                                                                                                                                                                                                                                                                                     |
|               |                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                |
|               |                   Filter: substr(customer.c_phone, Int64(1), Int64(2)) IN ([Utf8("13"), Utf8("31"), Utf8("23"), Utf8("29"), Utf8("30"), Utf8("18"), Utf8("17")])                                                                                                                                                                                                                  |
|               |                     TableScan: customer projection=[c_custkey, c_phone, c_acctbal], partial_filters=[substr(customer.c_phone, Int64(1), Int64(2)) IN ([Utf8("13"), Utf8("31"), Utf8("23"), Utf8("29"), Utf8("30"), Utf8("18"), Utf8("17")])]                                                                                                                                      |
|               |                 SubqueryAlias: __correlated_sq_1                                                                                                                                                                                                                                                                                                                                  |
|               |                   TableScan: orders projection=[o_custkey]                                                                                                                                                                                                                                                                                                                        |
|               |             SubqueryAlias: __scalar_sq_2                                                                                                                                                                                                                                                                                                                                          |
|               |               Aggregate: groupBy=[[]], aggr=[[avg(customer.c_acctbal)]]                                                                                                                                                                                                                                                                                                           |
|               |                 Projection: customer.c_acctbal                                                                                                                                                                                                                                                                                                                                    |
|               |                   Filter: customer.c_acctbal > Decimal128(Some(0),15,2) AND substr(customer.c_phone, Int64(1), Int64(2)) IN ([Utf8("13"), Utf8("31"), Utf8("23"), Utf8("29"), Utf8("30"), Utf8("18"), Utf8("17")])                                                                                                                                                                |
|               |                     TableScan: customer projection=[c_phone, c_acctbal], partial_filters=[customer.c_acctbal > Decimal128(Some(0),15,2) AS customer.c_acctbal > Decimal128(Some(0),30,15), substr(customer.c_phone, Int64(1), Int64(2)) IN ([Utf8("13"), Utf8("31"), Utf8("23"), Utf8("29"), Utf8("30"), Utf8("18"), Utf8("17")]), customer.c_acctbal > Decimal128(Some(0),15,2)] |
| physical_plan | SortPreservingMergeExec: [cntrycode@0 ASC NULLS LAST]                                                                                                                                                                                                                                                                                                                             |
|               |   SortExec: expr=[cntrycode@0 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                       |
|               |     ProjectionExec: expr=[cntrycode@0 as cntrycode, count(*)@1 as numcust, sum(custsale.c_acctbal)@2 as totacctbal]                                                                                                                                                                                                                                                               |
|               |       AggregateExec: mode=FinalPartitioned, gby=[cntrycode@0 as cntrycode], aggr=[count(*), sum(custsale.c_acctbal)]                                                                                                                                                                                                                                                              |
|               |         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                               |
|               |           RepartitionExec: partitioning=Hash([cntrycode@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                |
|               |             AggregateExec: mode=Partial, gby=[cntrycode@0 as cntrycode], aggr=[count(*), sum(custsale.c_acctbal)]                                                                                                                                                                                                                                                                 |
|               |               ProjectionExec: expr=[substr(c_phone@0, 1, 2) as cntrycode, c_acctbal@1 as c_acctbal]                                                                                                                                                                                                                                                                               |
|               |                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                              |
|               |                   NestedLoopJoinExec: join_type=Inner, filter=CAST(c_acctbal@0 AS Decimal128(19, 6)) > avg(customer.c_acctbal)@1                                                                                                                                                                                                                                                  |
|               |                     CoalescePartitionsExec                                                                                                                                                                                                                                                                                                                                        |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                 |
|               |                         HashJoinExec: mode=Partitioned, join_type=LeftAnti, on=[(c_custkey@0, o_custkey@0)], projection=[c_phone@1, c_acctbal@2]                                                                                                                                                                                                                                  |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                             |
|               |                             RepartitionExec: partitioning=Hash([c_custkey@0], 4), input_partitions=4                                                                                                                                                                                                                                                                              |
|               |                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                  |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                       |
|               |                                   FilterExec: Use substr(c_phone@1, 1, 2) IN (SET) ([Literal { value: Utf8("13") }, Literal { value: Utf8("31") }, Literal { value: Utf8("23") }, Literal { value: Utf8("29") }, Literal { value: Utf8("30") }, Literal { value: Utf8("18") }, Literal { value: Utf8("17") }])                                                                    |
|               |                                     SchemaCastScanExec                                                                                                                                                                                                                                                                                                                            |
|               |                                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                        |
|               |                                         MemoryExec: partitions=1, partition_sizes=[19]                                                                                                                                                                                                                                                                                            |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                             |
|               |                             RepartitionExec: partitioning=Hash([o_custkey@0], 4), input_partitions=4                                                                                                                                                                                                                                                                              |
|               |                               SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                              |
|               |                                   MemoryExec: partitions=1, partition_sizes=[184]                                                                                                                                                                                                                                                                                                 |
|               |                     AggregateExec: mode=Final, gby=[], aggr=[avg(customer.c_acctbal)]                                                                                                                                                                                                                                                                                             |
|               |                       CoalescePartitionsExec                                                                                                                                                                                                                                                                                                                                      |
|               |                         AggregateExec: mode=Partial, gby=[], aggr=[avg(customer.c_acctbal)]                                                                                                                                                                                                                                                                                       |
|               |                           ProjectionExec: expr=[c_acctbal@1 as c_acctbal]                                                                                                                                                                                                                                                                                                         |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                           |
|               |                               FilterExec: c_acctbal@1 > Some(0),15,2 AND Use substr(c_phone@0, 1, 2) IN (SET) ([Literal { value: Utf8("13") }, Literal { value: Utf8("31") }, Literal { value: Utf8("23") }, Literal { value: Utf8("29") }, Literal { value: Utf8("30") }, Literal { value: Utf8("18") }, Literal { value: Utf8("17") }])                                         |
|               |                                 SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                            |
|               |                                     MemoryExec: partitions=1, partition_sizes=[19]                                                                                                                                                                                                                                                                                                |
|               |                                                                                                                                                                                                                                                                                                                                                                                   |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
