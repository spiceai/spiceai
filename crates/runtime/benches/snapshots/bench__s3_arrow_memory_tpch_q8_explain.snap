---
source: crates/runtime/benches/bench.rs
description: "Query: select\n    o_year,\n    sum(case\n            when nation = 'BRAZIL' then volume\n            else 0\n        end) / sum(volume) as mkt_share\nfrom\n    (\n        select\n            extract(year from o_orderdate) as o_year,\n            l_extendedprice * (1 - l_discount) as volume,\n            n2.n_name as nation\n        from\n            part,\n            supplier,\n            lineitem,\n            orders,\n            customer,\n            nation n1,\n            nation n2,\n            region\n        where\n                p_partkey = l_partkey\n          and s_suppkey = l_suppkey\n          and l_orderkey = o_orderkey\n          and o_custkey = c_custkey\n          and c_nationkey = n1.n_nationkey\n          and n1.n_regionkey = r_regionkey\n          and r_name = 'AMERICA'\n          and s_nationkey = n2.n_nationkey\n          and o_orderdate between date '1995-01-01' and date '1996-12-31'\n          and p_type = 'ECONOMY ANODIZED STEEL'\n    ) as all_nations\ngroup by\n    o_year\norder by\n    o_year;"
---
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                          |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: all_nations.o_year ASC NULLS LAST                                                                                                                                                                                                                                                       |
|               |   Projection: all_nations.o_year, sum(CASE WHEN all_nations.nation = Utf8("BRAZIL") THEN all_nations.volume ELSE Int64(0) END) / sum(all_nations.volume) AS mkt_share                                                                                                                         |
|               |     Aggregate: groupBy=[[all_nations.o_year]], aggr=[[sum(CASE WHEN all_nations.nation = Utf8("BRAZIL") THEN all_nations.volume ELSE Decimal128(Some(0),38,4) END) AS sum(CASE WHEN all_nations.nation = Utf8("BRAZIL") THEN all_nations.volume ELSE Int64(0) END), sum(all_nations.volume)]] |
|               |       SubqueryAlias: all_nations                                                                                                                                                                                                                                                              |
|               |         Projection: date_part(Utf8("YEAR"), orders.o_orderdate) AS o_year, lineitem.l_extendedprice * (Decimal128(Some(1),20,0) - lineitem.l_discount) AS volume, n2.n_name AS nation                                                                                                         |
|               |           Inner Join: n1.n_regionkey = region.r_regionkey                                                                                                                                                                                                                                     |
|               |             Projection: lineitem.l_extendedprice, lineitem.l_discount, orders.o_orderdate, n1.n_regionkey, n2.n_name                                                                                                                                                                          |
|               |               Inner Join: supplier.s_nationkey = n2.n_nationkey                                                                                                                                                                                                                               |
|               |                 Projection: lineitem.l_extendedprice, lineitem.l_discount, supplier.s_nationkey, orders.o_orderdate, n1.n_regionkey                                                                                                                                                           |
|               |                   Inner Join: customer.c_nationkey = n1.n_nationkey                                                                                                                                                                                                                           |
|               |                     Projection: lineitem.l_extendedprice, lineitem.l_discount, supplier.s_nationkey, orders.o_orderdate, customer.c_nationkey                                                                                                                                                 |
|               |                       Inner Join: orders.o_custkey = customer.c_custkey                                                                                                                                                                                                                       |
|               |                         Projection: lineitem.l_extendedprice, lineitem.l_discount, supplier.s_nationkey, orders.o_custkey, orders.o_orderdate                                                                                                                                                 |
|               |                           Inner Join: lineitem.l_orderkey = orders.o_orderkey                                                                                                                                                                                                                 |
|               |                             Projection: lineitem.l_orderkey, lineitem.l_extendedprice, lineitem.l_discount, supplier.s_nationkey                                                                                                                                                              |
|               |                               Inner Join: lineitem.l_suppkey = supplier.s_suppkey                                                                                                                                                                                                             |
|               |                                 Projection: lineitem.l_orderkey, lineitem.l_suppkey, lineitem.l_extendedprice, lineitem.l_discount                                                                                                                                                            |
|               |                                   Inner Join: part.p_partkey = lineitem.l_partkey                                                                                                                                                                                                             |
|               |                                     Projection: part.p_partkey                                                                                                                                                                                                                                |
|               |                                       BytesProcessedNode                                                                                                                                                                                                                                      |
|               |                                         Filter: part.p_type = Utf8("ECONOMY ANODIZED STEEL")                                                                                                                                                                                                  |
|               |                                           TableScan: part projection=[p_partkey, p_type], partial_filters=[part.p_type = Utf8("ECONOMY ANODIZED STEEL")]                                                                                                                                      |
|               |                                     BytesProcessedNode                                                                                                                                                                                                                                        |
|               |                                       TableScan: lineitem projection=[l_orderkey, l_partkey, l_suppkey, l_extendedprice, l_discount]                                                                                                                                                          |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                            |
|               |                                   TableScan: supplier projection=[s_suppkey, s_nationkey]                                                                                                                                                                                                     |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                |
|               |                               Filter: orders.o_orderdate >= Date32("1995-01-01") AND orders.o_orderdate <= Date32("1996-12-31")                                                                                                                                                               |
|               |                                 TableScan: orders projection=[o_orderkey, o_custkey, o_orderdate], partial_filters=[orders.o_orderdate >= Date32("1995-01-01"), orders.o_orderdate <= Date32("1996-12-31")]                                                                                   |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                    |
|               |                           TableScan: customer projection=[c_custkey, c_nationkey]                                                                                                                                                                                                             |
|               |                     SubqueryAlias: n1                                                                                                                                                                                                                                                         |
|               |                       BytesProcessedNode                                                                                                                                                                                                                                                      |
|               |                         TableScan: nation projection=[n_nationkey, n_regionkey]                                                                                                                                                                                                               |
|               |                 SubqueryAlias: n2                                                                                                                                                                                                                                                             |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                          |
|               |                     TableScan: nation projection=[n_nationkey, n_name]                                                                                                                                                                                                                        |
|               |             Projection: region.r_regionkey                                                                                                                                                                                                                                                    |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                              |
|               |                 Filter: region.r_name = Utf8("AMERICA")                                                                                                                                                                                                                                       |
|               |                   TableScan: region projection=[r_regionkey, r_name], partial_filters=[region.r_name = Utf8("AMERICA")]                                                                                                                                                                       |
| physical_plan | SortPreservingMergeExec: [o_year@0 ASC NULLS LAST]                                                                                                                                                                                                                                            |
|               |   SortExec: expr=[o_year@0 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                      |
|               |     ProjectionExec: expr=[o_year@0 as o_year, sum(CASE WHEN all_nations.nation = Utf8("BRAZIL") THEN all_nations.volume ELSE Int64(0) END)@1 / sum(all_nations.volume)@2 as mkt_share]                                                                                                        |
|               |       AggregateExec: mode=FinalPartitioned, gby=[o_year@0 as o_year], aggr=[sum(CASE WHEN all_nations.nation = Utf8("BRAZIL") THEN all_nations.volume ELSE Int64(0) END), sum(all_nations.volume)]                                                                                            |
|               |         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                           |
|               |           RepartitionExec: partitioning=Hash([o_year@0], 4), input_partitions=4                                                                                                                                                                                                               |
|               |             AggregateExec: mode=Partial, gby=[o_year@0 as o_year], aggr=[sum(CASE WHEN all_nations.nation = Utf8("BRAZIL") THEN all_nations.volume ELSE Int64(0) END), sum(all_nations.volume)]                                                                                               |
|               |               ProjectionExec: expr=[date_part(YEAR, o_orderdate@2) as o_year, l_extendedprice@0 * (Some(1),20,0 - l_discount@1) as volume, n_name@3 as nation]                                                                                                                                |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                   |
|               |                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(n_regionkey@3, r_regionkey@0)], projection=[l_extendedprice@0, l_discount@1, o_orderdate@2, n_name@4]                                                                                                                 |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                               |
|               |                       RepartitionExec: partitioning=Hash([n_regionkey@3], 4), input_partitions=4                                                                                                                                                                                              |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                           |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(s_nationkey@2, n_nationkey@0)], projection=[l_extendedprice@0, l_discount@1, o_orderdate@3, n_regionkey@4, n_name@6]                                                                                          |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                       |
|               |                               RepartitionExec: partitioning=Hash([s_nationkey@2], 4), input_partitions=4                                                                                                                                                                                      |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                   |
|               |                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(c_nationkey@4, n_nationkey@0)], projection=[l_extendedprice@0, l_discount@1, s_nationkey@2, o_orderdate@3, n_regionkey@6]                                                                             |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                               |
|               |                                       RepartitionExec: partitioning=Hash([c_nationkey@4], 4), input_partitions=4                                                                                                                                                                              |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                           |
|               |                                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(o_custkey@3, c_custkey@0)], projection=[l_extendedprice@0, l_discount@1, s_nationkey@2, o_orderdate@4, c_nationkey@6]                                                                         |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                       |
|               |                                               RepartitionExec: partitioning=Hash([o_custkey@3], 4), input_partitions=4                                                                                                                                                                        |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                   |
|               |                                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(l_orderkey@0, o_orderkey@0)], projection=[l_extendedprice@1, l_discount@2, s_nationkey@3, o_custkey@5, o_orderdate@6]                                                                 |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                               |
|               |                                                       RepartitionExec: partitioning=Hash([l_orderkey@0], 4), input_partitions=4                                                                                                                                                               |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                           |
|               |                                                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(l_suppkey@1, s_suppkey@0)], projection=[l_orderkey@0, l_extendedprice@2, l_discount@3, s_nationkey@5]                                                                         |
|               |                                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                       |
|               |                                                               RepartitionExec: partitioning=Hash([l_suppkey@1], 4), input_partitions=4                                                                                                                                                        |
|               |                                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                   |
|               |                                                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(p_partkey@0, l_partkey@1)], projection=[l_orderkey@1, l_suppkey@3, l_extendedprice@4, l_discount@5]                                                                   |
|               |                                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                               |
|               |                                                                       RepartitionExec: partitioning=Hash([p_partkey@0], 4), input_partitions=4                                                                                                                                                |
|               |                                                                         ProjectionExec: expr=[p_partkey@0 as p_partkey]                                                                                                                                                                       |
|               |                                                                           BytesProcessedExec                                                                                                                                                                                                  |
|               |                                                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                       |
|               |                                                                               FilterExec: p_type@1 = ECONOMY ANODIZED STEEL                                                                                                                                                                   |
|               |                                                                                 SchemaCastScanExec                                                                                                                                                                                            |
|               |                                                                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                        |
|               |                                                                                     MemoryExec: partitions=1, partition_sizes=[25]                                                                                                                                                            |
|               |                                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                               |
|               |                                                                       RepartitionExec: partitioning=Hash([l_partkey@1], 4), input_partitions=4                                                                                                                                                |
|               |                                                                         BytesProcessedExec                                                                                                                                                                                                    |
|               |                                                                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                |
|               |                                                                             SchemaCastScanExec                                                                                                                                                                                                |
|               |                                                                               MemoryExec: partitions=1, partition_sizes=[0]                                                                                                                                                                   |
|               |                                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                       |
|               |                                                               RepartitionExec: partitioning=Hash([s_suppkey@0], 4), input_partitions=4                                                                                                                                                        |
|               |                                                                 BytesProcessedExec                                                                                                                                                                                                            |
|               |                                                                   SchemaCastScanExec                                                                                                                                                                                                          |
|               |                                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                      |
|               |                                                                       MemoryExec: partitions=1, partition_sizes=[2]                                                                                                                                                                           |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                               |
|               |                                                       RepartitionExec: partitioning=Hash([o_orderkey@0], 4), input_partitions=4                                                                                                                                                               |
|               |                                                         BytesProcessedExec                                                                                                                                                                                                                    |
|               |                                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                         |
|               |                                                             FilterExec: o_orderdate@2 >= 1995-01-01 AND o_orderdate@2 <= 1996-12-31                                                                                                                                                           |
|               |                                                               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                            |
|               |                                                                 SchemaCastScanExec                                                                                                                                                                                                            |
|               |                                                                   MemoryExec: partitions=1, partition_sizes=[0]                                                                                                                                                                               |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                       |
|               |                                               RepartitionExec: partitioning=Hash([c_custkey@0], 4), input_partitions=4                                                                                                                                                                        |
|               |                                                 BytesProcessedExec                                                                                                                                                                                                                            |
|               |                                                   SchemaCastScanExec                                                                                                                                                                                                                          |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                      |
|               |                                                       MemoryExec: partitions=1, partition_sizes=[19]                                                                                                                                                                                          |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                               |
|               |                                       RepartitionExec: partitioning=Hash([n_nationkey@0], 4), input_partitions=4                                                                                                                                                                              |
|               |                                         BytesProcessedExec                                                                                                                                                                                                                                    |
|               |                                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                |
|               |                                             SchemaCastScanExec                                                                                                                                                                                                                                |
|               |                                               MemoryExec: partitions=1, partition_sizes=[1]                                                                                                                                                                                                   |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                       |
|               |                               RepartitionExec: partitioning=Hash([n_nationkey@0], 4), input_partitions=4                                                                                                                                                                                      |
|               |                                 BytesProcessedExec                                                                                                                                                                                                                                            |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                        |
|               |                                     SchemaCastScanExec                                                                                                                                                                                                                                        |
|               |                                       MemoryExec: partitions=1, partition_sizes=[1]                                                                                                                                                                                                           |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                               |
|               |                       RepartitionExec: partitioning=Hash([r_regionkey@0], 4), input_partitions=4                                                                                                                                                                                              |
|               |                         ProjectionExec: expr=[r_regionkey@0 as r_regionkey]                                                                                                                                                                                                                   |
|               |                           BytesProcessedExec                                                                                                                                                                                                                                                  |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                       |
|               |                               FilterExec: r_name@1 = AMERICA                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                          |
|               |                                   SchemaCastScanExec                                                                                                                                                                                                                                          |
|               |                                     MemoryExec: partitions=1, partition_sizes=[1]                                                                                                                                                                                                             |
|               |                                                                                                                                                                                                                                                                                               |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
