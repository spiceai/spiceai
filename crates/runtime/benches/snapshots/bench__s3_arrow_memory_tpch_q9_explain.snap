---
source: crates/runtime/benches/bench.rs
description: "Query: select\n    nation,\n    o_year,\n    sum(amount) as sum_profit\nfrom\n    (\n        select\n            n_name as nation,\n            extract(year from o_orderdate) as o_year,\n            l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount\n        from\n            part,\n            supplier,\n            lineitem,\n            partsupp,\n            orders,\n            nation\n        where\n                s_suppkey = l_suppkey\n          and ps_suppkey = l_suppkey\n          and ps_partkey = l_partkey\n          and p_partkey = l_partkey\n          and o_orderkey = l_orderkey\n          and s_nationkey = n_nationkey\n          and p_name like '%green%'\n    ) as profit\ngroup by\n    nation,\n    o_year\norder by\n    nation,\n    o_year desc;"
---
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                       |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: profit.nation ASC NULLS LAST, profit.o_year DESC NULLS FIRST                                                                                                                                                                                         |
|               |   Projection: profit.nation, profit.o_year, sum(profit.amount) AS sum_profit                                                                                                                                                                               |
|               |     Aggregate: groupBy=[[profit.nation, profit.o_year]], aggr=[[sum(profit.amount)]]                                                                                                                                                                       |
|               |       SubqueryAlias: profit                                                                                                                                                                                                                                |
|               |         Projection: nation.n_name AS nation, date_part(Utf8("YEAR"), orders.o_orderdate) AS o_year, lineitem.l_extendedprice * (Decimal128(Some(1),20,0) - lineitem.l_discount) - partsupp.ps_supplycost * lineitem.l_quantity AS amount                   |
|               |           Inner Join: supplier.s_nationkey = nation.n_nationkey                                                                                                                                                                                            |
|               |             Projection: lineitem.l_quantity, lineitem.l_extendedprice, lineitem.l_discount, supplier.s_nationkey, partsupp.ps_supplycost, orders.o_orderdate                                                                                               |
|               |               Inner Join: lineitem.l_orderkey = orders.o_orderkey                                                                                                                                                                                          |
|               |                 Projection: lineitem.l_orderkey, lineitem.l_quantity, lineitem.l_extendedprice, lineitem.l_discount, supplier.s_nationkey, partsupp.ps_supplycost                                                                                          |
|               |                   Inner Join: lineitem.l_suppkey = partsupp.ps_suppkey, lineitem.l_partkey = partsupp.ps_partkey                                                                                                                                           |
|               |                     Projection: lineitem.l_orderkey, lineitem.l_partkey, lineitem.l_suppkey, lineitem.l_quantity, lineitem.l_extendedprice, lineitem.l_discount, supplier.s_nationkey                                                                      |
|               |                       Inner Join: lineitem.l_suppkey = supplier.s_suppkey                                                                                                                                                                                  |
|               |                         Projection: lineitem.l_orderkey, lineitem.l_partkey, lineitem.l_suppkey, lineitem.l_quantity, lineitem.l_extendedprice, lineitem.l_discount                                                                                        |
|               |                           Inner Join: part.p_partkey = lineitem.l_partkey                                                                                                                                                                                  |
|               |                             Projection: part.p_partkey                                                                                                                                                                                                     |
|               |                               BytesProcessedNode                                                                                                                                                                                                           |
|               |                                 Filter: part.p_name LIKE Utf8("%green%")                                                                                                                                                                                   |
|               |                                   TableScan: part projection=[p_partkey, p_name], partial_filters=[part.p_name LIKE Utf8("%green%")]                                                                                                                       |
|               |                             BytesProcessedNode                                                                                                                                                                                                             |
|               |                               TableScan: lineitem projection=[l_orderkey, l_partkey, l_suppkey, l_quantity, l_extendedprice, l_discount]                                                                                                                   |
|               |                         BytesProcessedNode                                                                                                                                                                                                                 |
|               |                           TableScan: supplier projection=[s_suppkey, s_nationkey]                                                                                                                                                                          |
|               |                     BytesProcessedNode                                                                                                                                                                                                                     |
|               |                       TableScan: partsupp projection=[ps_partkey, ps_suppkey, ps_supplycost]                                                                                                                                                               |
|               |                 BytesProcessedNode                                                                                                                                                                                                                         |
|               |                   TableScan: orders projection=[o_orderkey, o_orderdate]                                                                                                                                                                                   |
|               |             BytesProcessedNode                                                                                                                                                                                                                             |
|               |               TableScan: nation projection=[n_nationkey, n_name]                                                                                                                                                                                           |
| physical_plan | SortPreservingMergeExec: [nation@0 ASC NULLS LAST,o_year@1 DESC]                                                                                                                                                                                           |
|               |   SortExec: expr=[nation@0 ASC NULLS LAST,o_year@1 DESC], preserve_partitioning=[true]                                                                                                                                                                     |
|               |     ProjectionExec: expr=[nation@0 as nation, o_year@1 as o_year, sum(profit.amount)@2 as sum_profit]                                                                                                                                                      |
|               |       AggregateExec: mode=FinalPartitioned, gby=[nation@0 as nation, o_year@1 as o_year], aggr=[sum(profit.amount)]                                                                                                                                        |
|               |         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                        |
|               |           RepartitionExec: partitioning=Hash([nation@0, o_year@1], 4), input_partitions=4                                                                                                                                                                  |
|               |             AggregateExec: mode=Partial, gby=[nation@0 as nation, o_year@1 as o_year], aggr=[sum(profit.amount)]                                                                                                                                           |
|               |               ProjectionExec: expr=[n_name@5 as nation, date_part(YEAR, o_orderdate@4) as o_year, l_extendedprice@1 * (Some(1),20,0 - l_discount@2) - ps_supplycost@3 * l_quantity@0 as amount]                                                            |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                |
|               |                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(s_nationkey@3, n_nationkey@0)], projection=[l_quantity@0, l_extendedprice@1, l_discount@2, ps_supplycost@4, o_orderdate@5, n_name@7]                                               |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                            |
|               |                       RepartitionExec: partitioning=Hash([s_nationkey@3], 4), input_partitions=4                                                                                                                                                           |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                        |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(l_orderkey@0, o_orderkey@0)], projection=[l_quantity@1, l_extendedprice@2, l_discount@3, s_nationkey@4, ps_supplycost@5, o_orderdate@7]                                    |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                    |
|               |                               RepartitionExec: partitioning=Hash([l_orderkey@0], 4), input_partitions=4                                                                                                                                                    |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                |
|               |                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(l_suppkey@2, ps_suppkey@1), (l_partkey@1, ps_partkey@0)], projection=[l_orderkey@0, l_quantity@3, l_extendedprice@4, l_discount@5, s_nationkey@6, ps_supplycost@9] |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                            |
|               |                                       RepartitionExec: partitioning=Hash([l_suppkey@2, l_partkey@1], 4), input_partitions=4                                                                                                                                |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                        |
|               |                                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(l_suppkey@2, s_suppkey@0)], projection=[l_orderkey@0, l_partkey@1, l_suppkey@2, l_quantity@3, l_extendedprice@4, l_discount@5, s_nationkey@7]              |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                    |
|               |                                               RepartitionExec: partitioning=Hash([l_suppkey@2], 4), input_partitions=4                                                                                                                                     |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                |
|               |                                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(p_partkey@0, l_partkey@1)], projection=[l_orderkey@1, l_partkey@2, l_suppkey@3, l_quantity@4, l_extendedprice@5, l_discount@6]                     |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                            |
|               |                                                       RepartitionExec: partitioning=Hash([p_partkey@0], 4), input_partitions=4                                                                                                                             |
|               |                                                         ProjectionExec: expr=[p_partkey@0 as p_partkey]                                                                                                                                                    |
|               |                                                           BytesProcessedExec                                                                                                                                                                               |
|               |                                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                    |
|               |                                                               FilterExec: p_name@1 LIKE %green%                                                                                                                                                            |
|               |                                                                 SchemaCastScanExec                                                                                                                                                                         |
|               |                                                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                     |
|               |                                                                     MemoryExec: partitions=1, partition_sizes=[25]                                                                                                                                         |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                            |
|               |                                                       RepartitionExec: partitioning=Hash([l_partkey@1], 4), input_partitions=4                                                                                                                             |
|               |                                                         BytesProcessedExec                                                                                                                                                                                 |
|               |                                                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                             |
|               |                                                             SchemaCastScanExec                                                                                                                                                                             |
|               |                                                               MemoryExec: partitions=1, partition_sizes=[0]                                                                                                                                                |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                    |
|               |                                               RepartitionExec: partitioning=Hash([s_suppkey@0], 4), input_partitions=4                                                                                                                                     |
|               |                                                 BytesProcessedExec                                                                                                                                                                                         |
|               |                                                   SchemaCastScanExec                                                                                                                                                                                       |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                   |
|               |                                                       MemoryExec: partitions=1, partition_sizes=[2]                                                                                                                                                        |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                            |
|               |                                       RepartitionExec: partitioning=Hash([ps_suppkey@1, ps_partkey@0], 4), input_partitions=4                                                                                                                              |
|               |                                         BytesProcessedExec                                                                                                                                                                                                 |
|               |                                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                             |
|               |                                             SchemaCastScanExec                                                                                                                                                                                             |
|               |                                               MemoryExec: partitions=1, partition_sizes=[0]                                                                                                                                                                |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                    |
|               |                               RepartitionExec: partitioning=Hash([o_orderkey@0], 4), input_partitions=4                                                                                                                                                    |
|               |                                 BytesProcessedExec                                                                                                                                                                                                         |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                     |
|               |                                     SchemaCastScanExec                                                                                                                                                                                                     |
|               |                                       MemoryExec: partitions=1, partition_sizes=[0]                                                                                                                                                                        |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                            |
|               |                       RepartitionExec: partitioning=Hash([n_nationkey@0], 4), input_partitions=4                                                                                                                                                           |
|               |                         BytesProcessedExec                                                                                                                                                                                                                 |
|               |                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                             |
|               |                             SchemaCastScanExec                                                                                                                                                                                                             |
|               |                               MemoryExec: partitions=1, partition_sizes=[1]                                                                                                                                                                                |
|               |                                                                                                                                                                                                                                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
