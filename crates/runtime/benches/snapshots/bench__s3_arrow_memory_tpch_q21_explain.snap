---
source: crates/runtime/benches/bench.rs
description: "Query: select\n    s_name,\n    count(*) as numwait\nfrom\n    supplier,\n    lineitem l1,\n    orders,\n    nation\nwhere\n        s_suppkey = l1.l_suppkey\n  and o_orderkey = l1.l_orderkey\n  and o_orderstatus = 'F'\n  and l1.l_receiptdate > l1.l_commitdate\n  and exists (\n        select\n            *\n        from\n            lineitem l2\n        where\n                l2.l_orderkey = l1.l_orderkey\n          and l2.l_suppkey <> l1.l_suppkey\n    )\n  and not exists (\n        select\n            *\n        from\n            lineitem l3\n        where\n                l3.l_orderkey = l1.l_orderkey\n          and l3.l_suppkey <> l1.l_suppkey\n          and l3.l_receiptdate > l3.l_commitdate\n    )\n  and s_nationkey = n_nationkey\n  and n_name = 'SAUDI ARABIA'\ngroup by\n    s_name\norder by\n    numwait desc,\n    s_name;"
---
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                          |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: numwait DESC NULLS FIRST, supplier.s_name ASC NULLS LAST                                                                                                                                |
|               |   Projection: supplier.s_name, count(*) AS numwait                                                                                                                                            |
|               |     Aggregate: groupBy=[[supplier.s_name]], aggr=[[count(Int64(1)) AS count(*)]]                                                                                                              |
|               |       Projection: supplier.s_name                                                                                                                                                             |
|               |         LeftAnti Join: l1.l_orderkey = __correlated_sq_2.l_orderkey Filter: __correlated_sq_2.l_suppkey != l1.l_suppkey                                                                       |
|               |           LeftSemi Join: l1.l_orderkey = __correlated_sq_1.l_orderkey Filter: __correlated_sq_1.l_suppkey != l1.l_suppkey                                                                     |
|               |             Projection: supplier.s_name, l1.l_orderkey, l1.l_suppkey                                                                                                                          |
|               |               Inner Join: supplier.s_nationkey = nation.n_nationkey                                                                                                                           |
|               |                 Projection: supplier.s_name, supplier.s_nationkey, l1.l_orderkey, l1.l_suppkey                                                                                                |
|               |                   Inner Join: l1.l_orderkey = orders.o_orderkey                                                                                                                               |
|               |                     Projection: supplier.s_name, supplier.s_nationkey, l1.l_orderkey, l1.l_suppkey                                                                                            |
|               |                       Inner Join: supplier.s_suppkey = l1.l_suppkey                                                                                                                           |
|               |                         BytesProcessedNode                                                                                                                                                    |
|               |                           TableScan: supplier projection=[s_suppkey, s_name, s_nationkey]                                                                                                     |
|               |                         SubqueryAlias: l1                                                                                                                                                     |
|               |                           Projection: lineitem.l_orderkey, lineitem.l_suppkey                                                                                                                 |
|               |                             BytesProcessedNode                                                                                                                                                |
|               |                               Filter: lineitem.l_receiptdate > lineitem.l_commitdate                                                                                                          |
|               |                                 TableScan: lineitem projection=[l_orderkey, l_suppkey, l_commitdate, l_receiptdate], partial_filters=[lineitem.l_receiptdate > lineitem.l_commitdate]         |
|               |                     Projection: orders.o_orderkey                                                                                                                                             |
|               |                       BytesProcessedNode                                                                                                                                                      |
|               |                         Filter: orders.o_orderstatus = Utf8("F")                                                                                                                              |
|               |                           TableScan: orders projection=[o_orderkey, o_orderstatus], partial_filters=[orders.o_orderstatus = Utf8("F")]                                                        |
|               |                 Projection: nation.n_nationkey                                                                                                                                                |
|               |                   BytesProcessedNode                                                                                                                                                          |
|               |                     Filter: nation.n_name = Utf8("SAUDI ARABIA")                                                                                                                              |
|               |                       TableScan: nation projection=[n_nationkey, n_name], partial_filters=[nation.n_name = Utf8("SAUDI ARABIA")]                                                              |
|               |             SubqueryAlias: __correlated_sq_1                                                                                                                                                  |
|               |               SubqueryAlias: l2                                                                                                                                                               |
|               |                 BytesProcessedNode                                                                                                                                                            |
|               |                   TableScan: lineitem projection=[l_orderkey, l_suppkey]                                                                                                                      |
|               |           SubqueryAlias: __correlated_sq_2                                                                                                                                                    |
|               |             SubqueryAlias: l3                                                                                                                                                                 |
|               |               Projection: lineitem.l_orderkey, lineitem.l_suppkey                                                                                                                             |
|               |                 BytesProcessedNode                                                                                                                                                            |
|               |                   Filter: lineitem.l_receiptdate > lineitem.l_commitdate                                                                                                                      |
|               |                     TableScan: lineitem projection=[l_orderkey, l_suppkey, l_commitdate, l_receiptdate], partial_filters=[lineitem.l_receiptdate > lineitem.l_commitdate]                     |
| physical_plan | SortPreservingMergeExec: [numwait@1 DESC,s_name@0 ASC NULLS LAST]                                                                                                                             |
|               |   SortExec: expr=[numwait@1 DESC,s_name@0 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                       |
|               |     ProjectionExec: expr=[s_name@0 as s_name, count(*)@1 as numwait]                                                                                                                          |
|               |       AggregateExec: mode=FinalPartitioned, gby=[s_name@0 as s_name], aggr=[count(*)]                                                                                                         |
|               |         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                           |
|               |           RepartitionExec: partitioning=Hash([s_name@0], 4), input_partitions=4                                                                                                               |
|               |             AggregateExec: mode=Partial, gby=[s_name@0 as s_name], aggr=[count(*)]                                                                                                            |
|               |               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                     |
|               |                 HashJoinExec: mode=Partitioned, join_type=LeftAnti, on=[(l_orderkey@1, l_orderkey@0)], filter=l_suppkey@1 != l_suppkey@0, projection=[s_name@0]                               |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                 |
|               |                     HashJoinExec: mode=Partitioned, join_type=LeftSemi, on=[(l_orderkey@1, l_orderkey@0)], filter=l_suppkey@1 != l_suppkey@0                                                  |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                             |
|               |                         RepartitionExec: partitioning=Hash([l_orderkey@1], 4), input_partitions=4                                                                                             |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                         |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(s_nationkey@1, n_nationkey@0)], projection=[s_name@0, l_orderkey@2, l_suppkey@3]                            |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                     |
|               |                                 RepartitionExec: partitioning=Hash([s_nationkey@1], 4), input_partitions=4                                                                                    |
|               |                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                 |
|               |                                     HashJoinExec: mode=Partitioned, join_type=Inner, on=[(l_orderkey@2, o_orderkey@0)], projection=[s_name@0, s_nationkey@1, l_orderkey@2, l_suppkey@3]       |
|               |                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                             |
|               |                                         RepartitionExec: partitioning=Hash([l_orderkey@2], 4), input_partitions=4                                                                             |
|               |                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                         |
|               |                                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(s_suppkey@0, l_suppkey@1)], projection=[s_name@1, s_nationkey@2, l_orderkey@3, l_suppkey@4] |
|               |                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                     |
|               |                                                 RepartitionExec: partitioning=Hash([s_suppkey@0], 4), input_partitions=4                                                                      |
|               |                                                   BytesProcessedExec                                                                                                                          |
|               |                                                     SchemaCastScanExec                                                                                                                        |
|               |                                                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                    |
|               |                                                         MemoryExec: partitions=1, partition_sizes=[2]                                                                                         |
|               |                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                     |
|               |                                                 RepartitionExec: partitioning=Hash([l_suppkey@1], 4), input_partitions=4                                                                      |
|               |                                                   ProjectionExec: expr=[l_orderkey@0 as l_orderkey, l_suppkey@1 as l_suppkey]                                                                 |
|               |                                                     BytesProcessedExec                                                                                                                        |
|               |                                                       CoalesceBatchesExec: target_batch_size=8192                                                                                             |
|               |                                                         FilterExec: l_receiptdate@3 > l_commitdate@2                                                                                          |
|               |                                                           SchemaCastScanExec                                                                                                                  |
|               |                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                              |
|               |                                                               MemoryExec: partitions=1, partition_sizes=[733]                                                                                 |
|               |                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                             |
|               |                                         RepartitionExec: partitioning=Hash([o_orderkey@0], 4), input_partitions=4                                                                             |
|               |                                           ProjectionExec: expr=[o_orderkey@0 as o_orderkey]                                                                                                   |
|               |                                             BytesProcessedExec                                                                                                                                |
|               |                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                     |
|               |                                                 FilterExec: o_orderstatus@1 = F                                                                                                               |
|               |                                                   SchemaCastScanExec                                                                                                                          |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                      |
|               |                                                       MemoryExec: partitions=1, partition_sizes=[184]                                                                                         |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                     |
|               |                                 RepartitionExec: partitioning=Hash([n_nationkey@0], 4), input_partitions=4                                                                                    |
|               |                                   ProjectionExec: expr=[n_nationkey@0 as n_nationkey]                                                                                                         |
|               |                                     BytesProcessedExec                                                                                                                                        |
|               |                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                             |
|               |                                         FilterExec: n_name@1 = SAUDI ARABIA                                                                                                                   |
|               |                                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                |
|               |                                             SchemaCastScanExec                                                                                                                                |
|               |                                               MemoryExec: partitions=1, partition_sizes=[1]                                                                                                   |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                             |
|               |                         RepartitionExec: partitioning=Hash([l_orderkey@0], 4), input_partitions=4                                                                                             |
|               |                           BytesProcessedExec                                                                                                                                                  |
|               |                             SchemaCastScanExec                                                                                                                                                |
|               |                               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                            |
|               |                                 MemoryExec: partitions=1, partition_sizes=[733]                                                                                                               |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                 |
|               |                     RepartitionExec: partitioning=Hash([l_orderkey@0], 4), input_partitions=4                                                                                                 |
|               |                       ProjectionExec: expr=[l_orderkey@0 as l_orderkey, l_suppkey@1 as l_suppkey]                                                                                             |
|               |                         BytesProcessedExec                                                                                                                                                    |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                         |
|               |                             FilterExec: l_receiptdate@3 > l_commitdate@2                                                                                                                      |
|               |                               SchemaCastScanExec                                                                                                                                              |
|               |                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                          |
|               |                                   MemoryExec: partitions=1, partition_sizes=[733]                                                                                                             |
|               |                                                                                                                                                                                               |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
