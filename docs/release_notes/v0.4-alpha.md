# Spice.ai v0.4-alpha

We are excited to announce the release of Spice.ai v0.4-alpha! üèÑ‚Äç‚ôÇÔ∏è

Highlights include adding support for authoring reward functions in an external code file, calculated time categories, the ability to ask for a recommendation at a specific time, and ingestion support for transaction/correlation ids.

If you are new to Spice.ai, check out the [getting started guide](https://docs.spiceai.org/getting-started/) and star [spiceai/spiceai](https://github.com/spiceai/spiceai) on GitHub.

## Highlights in v0.4-alpha

### Upgrade using `spice upgrade`

With the last release adding support for the `spice upgrade` command, this is the first release where you can upgrade by simply running `spice upgrade` in your terminal.

### Reward Function Files

Instead of defining reward functions by writing Python code in a YAML file, it is now possible to write reward functions in a separate Python file.

The name of a function defined in an external Python file can be mapped to a reward `with` node instead of the inline Python code. The file can be referenced by a new node called `reward_funcs`.

Example:

```yaml
training:
  reward_funcs: my_reward.py
  rewards:
    - reward: buy
      with: buy_reward
    - reward: sell
      with: sell_reward
    - reward: hold
      with: hold_reward
```

See more in the documentation: https://docs.spiceai.org/concepts/rewards/external

### Time Categories

Now you can specify time categories in the pod manifest, such as month or weekday enabling the automatic creation of fields from the observation time. For example, by specifiying month the Spice.ai engine automatically creates a field in the data called time_month_{month} with a value calculated from the month of which that timestamp relates. This enables learning from cyclical patterns, such as monthly or daily cycles.

Example:

```yaml
time:
  categories:
    - month
    - dayofweek
```

Supported category values are:
`month` `dayofmonth` `dayofweek` `hour`

See more in the documentation: https://docs.spiceai.org/reference/pod/#time

### Get recommendation for a specific time

Previously the `/recommendation` API only supported getting a recommendation based on the last data point ingested into the system. Now it is possible to ask for a recommendation based on a specific time.

Make a request using the following format:
`GET http://localhost:8000/api/v0.1/pods/{pod}/recommendation?time={unix_timestamp}`

An example for `quickstarts/trader`

`GET http://localhost:8000/api/v0.1/pods/trader/recommendation?time=1605729600`

Specifying `{unix_timestamp}` as `0` is the same as asking for the latest data. An invalid `{unix_timestamp}` will return a result that has the valid time range in the error message:

```json
{
  "response": {
    "result": "invalid_recommendation_time",
    "message": "The time specified (1610060201) is outside of the allowed range: (1610057600, 1610060200)",
    "error": true
  }
}
```

## New in this release

- **Adds** time categories to the pod manifest to allow learning from cyclical patterns in data - e.g. hour, day of week, day of month, and month
- **Adds** support for defining reward functions in an external Python file.
- **Adds** the ability to get a recommendation for a specific time. Now it is possible to see which action the AI would have recommended at a previous time.
- **Adds** support for ingestion of transaction/correlation identifiers (e.g. `order_id`, `trace_id`) in the pod manifest.
- **Adds** validation for invalid dataspace names in the pod manifest.
- **Updates** TensorFlow and Keras to 2.7
- **Fixes** an issue in the data visualization where a data column might not be shown.
